var postmark = require("postmark")(process.env.POSTMARK_API_KEY);


var subj = {'reset' : "Your Reset Request...",
            'newReg' : "Code for Huntsville Membership Confirmation"}

function send(to, subject, textstrs, response) {
  postmark.send({
    "From": "contacts@code4huntsville.org",
    "To": to,
	//"Bcc": "lmason@HungryProgrammer.com",
    "Subject": subject,
    "TextBody": textstrs[0],
    "Tag": "Join request"
  }, function(error, success) {
    if(error) {
      console.error("Unable to send via postmark: " + error.message);
      var rdata = JSON.stringify({"error":error});
	  response.writeHead(401, {"Content-Type": "application/json"});
      response.write(rdata);
      return;
    } else {
      console.info("Sent to postmark for delivery ");
      var rdata = JSON.stringify(textstrs[1]);
	  response.writeHead(200, {"Content-Type": "application/json"});
	  console.info("Responce: " + rdata);
      response.write(rdata);
    }
	response.end();
    //transport.close();	
  });
  //var mailOptions = {
  //  from: "The Rocket Hatch Team", //config.emailAdmin,
  //  to: to,
  //  subject: subj[subject],
  //  text: textstrs[0]
  //}
  /*
  transport.sendMail(mailOptions, function(error, result){
    if(error){
	  console.log("Send Message Error: " + error);
      var rdata = JSON.stringify({"error":error});
	  response.writeHead(401, {"Content-Type": "application/json"});
      response.write(rdata);
    }else{
	  var rdata = JSON.stringify(textstrs[1]);
	  response.writeHead(200, {"Content-Type": "application/json"});
      response.write(rdata);
    }
	response.end();
    transport.close();	
  });*/
}; 

exports.send = send;



